"use strict";(()=>{var $=Object.defineProperty,de=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var Z=(t,e,o)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,P=(t,e)=>{for(var o in e||(e={}))he.call(e,o)&&Z(t,o,e[o]);if(X)for(var o of X(e))Pe.call(e,o)&&Z(t,o,e[o]);return t},ee=(t,e)=>de(t,Oe(e));var Se=(t,e)=>{for(var o in e)$(t,o,{get:e[o],enumerable:!0})};var te=(t,e,o)=>new Promise((r,l)=>{var s=f=>{try{d(o.next(f))}catch(a){l(a)}},S=f=>{try{d(o.throw(f))}catch(a){l(a)}},d=f=>f.done?r(f.value):Promise.resolve(f.value).then(s,S);d((o=o.apply(t,e)).next())});var Q={};var h=Symbol("value"),oe=Symbol("remove"),K=Symbol("newKey"),Y=Symbol("hasAttachedSpec"),ve=Symbol("fromSpec"),He=Symbol("propertiesRegistry");var C={};Se(C,{objectify:()=>_});var k={},re=["Object","Array","Map","Set","Number","Boolean","String","Date","RegExp","Function","Promise","Symbol","BigInt","Error","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint16Array","Uint32Array","Uint8ClampedArray","ArrayBuffer","SharedArrayBuffer"];function I(t){var o;var e=[];if(t)do{let r=(o=t.constructor)==null?void 0:o.name,l=re.includes(r);re.includes(r)&&(k[r]||(k[r]=[...Object.getOwnPropertyNames(globalThis[r].prototype)])),Object.getOwnPropertyNames(t).forEach(function(s){l&&k[r].includes(s)||e.indexOf(s)===-1&&e.push(s)})}while(t=Object.getPrototypeOf(t));return e}var B=(t,e,o)=>(new Set([...I(e),...Object.getOwnPropertySymbols(e)]).forEach(l=>{if(!(l in t)&&l!==h){let s=Object.getOwnPropertyDescriptor(e,l);Object.defineProperty(t,l,o?P(P({},s),o):s)}}),t);var _=(t,e)=>{let o=e==null?void 0:e.constructor;if(Array.isArray(e)){let r=e;e=[],e=B(e,r)}else if(o){let r=e;Array.isArray(e)?e=[...e]:e=new o(e),e=B(e,r)}else if(!e){let r=e;e=Object.create(null),Object.defineProperty(e,h,{value:r})}return e};var ne=t=>t&&typeof t=="object"&&typeof t.then=="function";function Ae(t){return!isNaN(parseFloat(t))&&isFinite(t)}var G=Symbol("unresolved");function je(t,e,o){return t in e||o in e}function Ne(t,e,o){return t in e?t:o in e?o:void 0}function ie(t,e,o){var r;return t in e&&(r=e[t])!=null?r:e[o]}var V=(t,e,o={},r={},l=[],s=[],S={})=>{var A;let d=s.length===0;d&&s.push(t);let f=r.target===t,a=f?s[s.length-1]:d?(A=r.target)!=null?A:{}:t;if(K in a)return t;{let m=new Set([...I(t),...Object.getOwnPropertySymbols(t)]);m.delete("constructor");let c=new Set([...I(e),...e?Object.getOwnPropertySymbols(e):[]]),y=new Set(c),b={willUpdateOriginal:f},j=(i,N=s)=>{if(i===h||typeof i=="string"&&Ae(i))return;ae(i,l,N,a,o,e,r,b).forEach(w=>{c.delete(w),y.add(w)})},D=a;return S.properties!==!1&&m.forEach(i=>j(i)),S.specification!==!1&&c.forEach(i=>j(i)),K in a||Object.defineProperty(a,K,{value:(i,N,T)=>{let w=[...s],v=w[w.length-1]=f?t:P({},t);if(v[i]=N,T){let U=P({},T);!T.get&&!T.set&&(U.value=N),Object.defineProperty(e,i,U)}else e[i]=void 0;j(i,w)},writable:!1,configurable:!1}),globalThis.Proxy?D=new Proxy(a,{set(i,N,T){return y.has(N)?(i[N]=T,!0):!1}}):console.warn("[esconform] Proxy not available. Unregistered property setters will not be intercepted."),D}},ae=(t,e,o,r,l,s={},S={},d)=>{var W;let f=d.willUpdateOriginal,a=o[o.length-1],A=[...e,t],m=G,c=[],y=a?P({},Object.getOwnPropertyDescriptor(a,t)):{},b=l.keys?l.keys(t,s,e,o):t,j=b&&typeof b=="object",D=j?b.links:void 0;if(D)for(let u of D){let H=o[o.length-1]=f?a:P({},a);if(c.push(u.key),typeof u.update=="function"){let p=function(){let O="value"in u?u.value:m!==G?m:f?y.get?y.get.call(a):y.value:a[t];return M=ne(O)?O.then(E):E(O),be(M)},E=function(O){return O=se(u.key,O,[...e,u.key],o,l,s,S,d),O};var it=p,st=E;let M=G,be=u.update;Object.defineProperty(H,u.key,{get:p,set:O=>(M=O,M)})}else H[u.key]=u.value;ae(u.key,e,o,r,l,s,S,ee(P({},d),{linked:!0}))}let i=j?b.value:b,N=Ne(i,s,t),T=N?P({},Object.getOwnPropertyDescriptor(s,N)):{},w=j&&"enumerable"in b?b.enumerable:(W=T.enumerable)!=null?W:!1,v=typeof i,U=j&&"silence"in b?b.silence:!je(i,s,t)||i==null||i===oe||v!=="string"&&v!=="symbol"&&v==="object"&&!(i instanceof String)&&!(i instanceof Number),F=U?t:i;if(U&&!D)return delete r[t],c;c.push(F);let L=Object.getOwnPropertyDescriptor(r,F);if(L&&L.set&&L.configurable!==!0)r[F]=a[t];else{let u=function(p){return p&&typeof p=="object"&&(h in p&&(p=p[h]),p&&typeof p.valueOf=="function"&&(p=p.valueOf())),m=se(F,p,A,o,l,s,S,d),h in m?m[h]:m},H=function(){var E;let p;if(!U){if(m===G||d.linked){let O=f?y.get?y.get.call(a):y.value:(E=a?a[t]:void 0)!=null?E:ie(F,s,t);p=ne(O)?O.then(u):u(O)}else p=h in m?m[h]:m;return p}};var st=u,it=H;(!f||(y==null?void 0:y.configurable)!==!1)&&Object.defineProperty(r,F,{get:H,set:y.set?p=>(y.set(p),u(p)):u,enumerable:U?!1:w,configurable:!1})}return t!==F&&delete r[t],c},se=(t,e,o,r,l,s,S,d)=>{var i;let f=o[o.length-1];e!=null&&e[Y]&&(s[t]=e[Y]);let a=ie(t,s,f),A=l.values?l.values(f,e,a,o,r):e,c=A&&typeof A=="object"&&"value"in A?A.value:A,y=c&&((i=c==null?void 0:c.constructor)==null?void 0:i.name)==="Object",b=typeof c=="symbol"?c:y?P({},c):Array.isArray(c)?[...c]:_(t,c),j=e!=null?e:c;return(y||a&&typeof a=="object")&&V(b,a,l,S,o,[...r,j],{properties:y}),b},le=(t,e,o,r)=>V(t,e,{keys:o},r),ce=(t,e,o,r)=>V(t,e,o,r),pe=(t,e,o,r)=>V(t,e,{values:o},r);var R=class{constructor(e){this.config={};this.set=e=>{this.config=e;let o=this.config.specification;if(Array.isArray(o)){let r=this.config.specification={};o.forEach(l=>B(r,l))}this.specification=this.config.specification};this.apply=(e,o)=>ce(e,this.config.specification,this.config,o);this.keys=(e,o)=>le(e,this.config.specification,this.config.keys,o);this.values=(e,o)=>pe(e,this.config.specification,this.config.values,o);this.set(e)}};var J=Symbol("symbol"),x={number:1,string:"hi there",boolean:!0,object:{number:"hi there"},array:[1,2,3],float32:new Float32Array([1,2,3]),[J]:"this is a symbol",function:()=>{console.log("hi there")},undefined:void 0,null:null},q={Number:!0,String:!0,Boolean:!0,Object:{Boolean:!0},Undefined:{type:"any"}},we=[J,"Array","Float32","Function","Null"];we.forEach(t=>{Object.defineProperty(q,t,{value:!0})});var xe=["Number","String"];xe.forEach(t=>{Object.defineProperty(q.Object,t,{value:!0})});var ye=(t,e)=>{let o;Object.defineProperty(x,t,{get:()=>e(o),set:r=>o=r,enumerable:!1,configurable:!0})};ye("hidden",t=>t);ye("promise",t=>new Promise(e=>setTimeout(()=>e(t),1e3)));var De=new R({values:(t,e,o)=>C.objectify(t,e),keys:t=>(typeof t=="string"&&(t=t[0].toUpperCase()+t.slice(1)),t),specification:q}),n=De.apply(x);console.log("Got!",n);console.log("Original!",x);console.log("--------- Enumerating  ---------");var Ue=Object.keys(n);console.log("Got keys",Ue);for(let t in n)console.log("Enumerable",t,n[t]);console.log("--------- Setting hidden value on original ---------");console.log("Hidden value (output, before)",n.Hidden);x.hidden=5;console.log("Hidden value (output)",n.Hidden);console.log("Hidden value (original)",x.hidden);console.log("--------- Setting hidden value on output ---------");n.Hidden=10;console.log("Hidden value (output)",n.Hidden);console.log("Hidden value (original)",x.hidden);console.log("--------- Getting symbol value ---------");console.log("Symbol value (output)",n[J]);console.log("Symbol value (original)",x[J]);console.log("--------- Updating number value ---------");console.log("Number value (before)",n.Number);n.Number=10;console.log("Number value (after)",n.Number);console.log("--------- Updating object value ---------");console.log("Object value (before)",n.Object);n.Object={number:Math.pow(2,32),string:"this is a string",boolean:"Not a boolean..."};console.log("Object value (after)",n.Object);console.log("--------- Adding nested property to Typed Array ---------");console.log("Typed array property value (before)",n.Float32.test);n.Float32.test=!0;console.log("Typed array property value (after)",n.Float32.test);var fe;console.log("Typed array property value (original)",(fe=x.float32)==null?void 0:fe.test);var Fe=()=>te(void 0,null,function*(){console.log("--------- Checking promise value ---------"),console.log("Promise value (before)",n.Promise),n.Promise=20,console.log("Promise value (after)",n.Promise)});window.onmousedown=()=>Fe();console.log("--------- Setting undefined ---------");console.log("Undefined value (before)",n.Undefined);n.Undefined="should have metadata";console.log("Undefined value (after)",n.Undefined);console.log("--------- Adding new key through special symbol ---------");n[K]("test","AHHH",{enumerable:!1,configurable:!0});console.log("test",n.Test);n[K]("test","OOF",{enumerable:!1});console.log("test",n.Test);n.Test="EEK";console.log("test",n.Test);console.log("---------------- ADVANCED DEMO ----------------");var z={firstName:"string",lastName:"string",age:"number",address:{type:"string"},dateOfBirth:"isodatetime"};Object.defineProperty(z,"address",{value:z.address});var Ee=new R({values:(t,e,o)=>e&&o==="isodatetime"?new Date(e).toISOString():e,keys:(t,e)=>{let o={value:t};return t==="fullName"&&(o.links=[{key:"firstName",update:r=>r.split(" ")[0]},{key:"lastName",update:r=>r.split(" ")[1]}]),o},specification:z}),ue={fullName:"John Doe",age:30,address:"123 Main St",extra:"THIS IS REALLY ANNOYING"},ge={},g=Ee.apply(ue,{target:ge});console.log("John",g);console.log("Data",ue);console.log("Target",ge);console.log("firstName",g.firstName);console.log("lastName",g.lastName);console.log("fullName",g.fullName);console.log("extra",g.extra,"extra"in g);g.extra="TEST";console.log("extra",g.extra,"extra"in g);g.fullName="Jane Doe";console.log("firstName",g.firstName);console.log("lastName",g.lastName);console.log("fullName",g.fullName);var me=new Date("1990-01-01");console.log("DoB",me);g.dateOfBirth=me;console.log("DoB",g.dateOfBirth);typeof globalThis.conform!="undefined"?Object.assign(globalThis.conform,Q):globalThis.conform=Q;})();
//# sourceMappingURL=index.js.map
